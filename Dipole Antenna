% Parameters
f = 300e6;            % Frequency (Hz)
c = 3e8;              % Speed of light (m/s)
lambda = c / f;       % Wavelength (m)
k = 2*pi/lambda;      % Wavenumber
L = 3*lambda;         % Dipole length (half-wave)
N = 500;              % Number of segments

dz = L/N;             % Segment length
z_prime = linspace(-L/2 + dz/2, L/2 - dz/2, N); % Source points along dipole

% Assume standing wave current distribution (half-wave dipole)
I0 = 1; % Amplitude
I_z = I0 * cos(k * (L/2 - abs(z_prime))); % Standing wave current

% Observation parameters
r_obs = 1000; % Large radius (far-field)
t = 0; % Time (arbitrary for time-harmonic fields)

% Sweep theta from 0 to pi
theta = linspace(0, 2*pi, 360);
psi_theta = zeros(size(theta));

% Loop over theta angles
for idx = 1:length(theta)
    th = theta(idx);
    
    % Observation point
    x_obs = r_obs * sin(th);
    y_obs = 0;
    z_obs = r_obs * cos(th);
    obs = [x_obs, y_obs, z_obs];
    
    psi = 0;
    
    for n = 1:N
        % Source point (only z' varies)
        source = [0, 0, z_prime(n)];
        
        % Distance from source to observation point
        R = norm(obs - source);
        
        % Retarded time
        t_ret = t - R/c;
        
        % Current at retarded time (harmonic)
        I_ret = I_z(n) * exp(-1i*2*pi*f*t_ret);
        
        % Contribution to psi
        dpsi = (I_ret / R) * dz;
        
        psi = psi + dpsi;
    end
    
    % Scale by 1/(4*pi)
    psi_theta(idx) = abs(psi / (4*pi));
end

% Normalize
psi_theta = psi_theta / max(psi_theta);

% Plot Radiation Pattern (Polar Plot)
figure;
polarplot(theta, psi_theta, 'LineWidth', 2);
title('Normalized Radiation Pattern of Thin Dipole Antenna');
rlim([0 1]);
set(gca, 'ThetaZeroLocation', 'top', 'ThetaDir', 'clockwise');
